{% extends "base.html" %} {% block main %}
{% load static %}
<div class="row">
    <div class="col s12 l10 offset-l1" style="padding: 3rem 0 5rem 0">
        <!--Melhorar design-->
        <form action="" method="post" enctype="multipart/form-data">
            {% csrf_token %} {% block form %}
            <div class="row">
                <div class="errornote">
                    <font color="red">
                        {{form.non_field_errors}}
                    </font>
                </div>

                {% for field in form %}
                <div class="col s12 m6">
                    {{field.label_tag}} <br> {{field}}
                    <div class="errornote">
                        <font color="red">
                            {{field.errors}}
                        </font>
                    </div>
                </div>
                {% endfor %} <br> {% for field in form_user %}
                <div class="col s12">
                    {{field.label_tag}} {{field}}
                    <div class="errornote">
                        <font color="red">
                            {{field.errors}}
                        </font>
                    </div>
                </div>
                {% endfor %}
                <!--
                    <p>Sua senha deve ter no mínimo 08 caracteres, composta por letras maiúsculas e minúsculas e números</p>
                -->
                <p class="errornote">
                    <font color="red">
                        {{form_user.non_field_errors}}
                    </font>
                </p>
            </div>
            <div class="row">
                <input class="btn col s12 m6" type="submit" value="Enviar">
            </div>
            {% endblock form %}
        </form>
    </div>
</div>
{% endblock main %}

{% block header %}
<!--autocomplete select2-->
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
<style>
    .select2 {
        max-width: 100% !important;
    }

    span {
        outline: 0 !important;
        /*removendo outiline do select2 autocomplete*/
    }
</style>
{% endblock header %} {% block script %}
<!--autocomplete select2-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
<script>
    $('select').select2(); //autocomplete select2
</script>


<script src="{% static 'registros/js/jquery-file-upload/vendor/jquery.ui.widget.js' %}"></script>
<script src="{% static 'registros/js/jquery-file-upload/jquery.iframe-transport.js' %}"></script>
<script src="{% static 'registros/js/jquery-file-upload/jquery.fileupload.js' %}"></script>
<!-- <script src="{% static 'registros/js/basic-upload.js' %}"></script> -->
<script>
    $(function () {

        $(".js-upload-photos").click(function () {
            $("#fileupload").click();
        });

        function bytesToSize(bytes) {
            var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            if (bytes == 0) return '0 Byte';
            var i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
            return Math.round(bytes / Math.pow(1024, i), 2) + ' ' + sizes[i];
        }
        // $('#fileupload').bind('change', function () {
        //     var fileExtension = ['jpeg', 'jpg', 'png', 'gif', 'bmp'];
        //     if ($.inArray($(this).val().split('.').pop().toLowerCase(), fileExtension) == -1) {
        //         alert("Only formats are allowed : "+fileExtension.join(', '));
        //     }else{
        //         is_valid = true
        //     }
        //     let size = bytesToSize(this.files[0].size)
        //     // alert(size)
        //     //this.files[0].size gets the size of your file.
        //     // alert(this.files[0].size);
        // });

        function check_type() {
            var fileExtension = ['jpeg', 'jpg', 'png', 'gif', 'bmp'];
            if ($.inArray($("#fileupload").val().split('.').pop().toLowerCase(), fileExtension) == -1) {
                alert("Only formats are allowed : " + fileExtension.join(', '));
            }
        }

        var is_valid = false;
        $("#fileupload").fileupload({
            dataType: 'json',
            sequentialUploads: true,  /* 1. SEND THE FILES ONE BY ONE */
            autoUpload: false,
            add: function (e, data) {
                var fileExtension = ['jpeg', 'jpg', 'png', 'gif', 'bmp'];
                data.files.forEach(element => {
                    let extention = element.name.split('.').pop().toLowerCase()
                    if ($.inArray(extention, fileExtension) == -1) {
                        alert("Only formats are allowed : " + fileExtension.join(', '));
                    }else{
                        data.submit()
                    }
                });
            },
            start: function (e) {  /* 2. WHEN THE UPLOADING PROCESS STARTS, SHOW THE MODAL */
                // console.log(e)
            },
            stop: function (e) {  /* 3. WHEN THE UPLOADING PROCESS FINALIZE, HIDE THE MODAL */

            },
            progressall: function (e, data) {  /* 4. UPDATE THE PROGRESS BAR */
                var progress = parseInt(data.loaded / data.total * 100, 10);
                var strProgress = progress + "%";
                // console.log(strProgress)
                $(".determinate").css({ "width": strProgress });
                $(".determinate").text(strProgress);
                $("#percent").text(strProgress);
            },
            done: function (e, data) {
                is_valid = false
                $(".determinate").css({ "width": "0%" });
                $("#percent").text("concluido ;)");
                if (data.result.is_valid) {
                    $("#gallery tbody").prepend(
                        "<tr><td><a href=''>" + data.result.name + " - " + data.result.size + " - " + data.result.key + "</a></td></tr>"
                    )
                }
            }

        });

    });

</script>

{% endblock script %}